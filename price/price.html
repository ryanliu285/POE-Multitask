<html>
  <head>
    <meta charset="UTF-8">
    <title>POE Multitask v0.1</title>
    <link rel = "stylesheet" href = "price.css">
    <script>
      require('electron-titlebar');
    </script>
    </script>
  </head>
  <body>
    <div id="electron-titlebar" class="drag"></div>
    <br>
    <br>
    <div style = "height:90%; overflow-y:auto;">
      &nbsp;
      <input id = "search" placeholder = "Search for items here"></input>
      <button id = "searchButton">Search</button>
      <button id = "refreshButton" onclick = "fill('Standard')">Refresh</button>
      <table id = "table" style="width:100%; font-weight:bold; text-align: left;">
        <tr id = "title">
          <th>Item</th>
          <th>Chaos</th>
          <th>Exalted</th>
          <th>Change</th>
        </tr>
      </table>
    </div>
  </body>
  <footer id = "buttons">
    <br>
    <button>Prices</button>
    <a href = "../farming/farming.html"><button>Farming Tool</button></a>
    <a href = "../twitch/twitchChannel.html"><button>Twitch Streams</button></a>
  </footer>
  <script>
  var selectedCategory = "Currency";
  var currentLeague = "Standard";
  async function fillLeagues(){
    const response = await fetch('https://api.poe.watch/leagues');
    const json = await response.json();
    var appendTarget = document.getElementById("refreshButton");
    var num = 0;
    var x = 0;
    while (num < json.length){
      const temp = json[num];
      if(temp.active == true){
        appendFunc(createElementFromHTML('<input type="checkbox" onclick = "toggle(this.id)"id="league' + x +'">'), appendTarget);
        appendTarget = document.getElementById('league' + x);
        appendFunc(createElementFromHTML('<label id = "label' +x+'" for="league' + x + '">' + temp.name + '</label>'), appendTarget);
        appendTarget = document.getElementById('label' + x);
        x++;
      }
      num++;
    }
    toggle('league' + (x-1));
    fillButtons();
  }
  async function fillButtons(){
    const response = await fetch('https://api.poe.watch/categories');
    const json = await response.json();
    var appendTarget = document.getElementById("buttons");
    var num = 0;
    while (num < json.length){
      const temp = json[num];
      appendFunc(createElementFromHTML('<button id = "'+temp['name']+'" onclick = "buttonToggle(this.id)">'+temp['display']+'</button>'), appendTarget);
      appendTarget = document.getElementById(temp['name']);
      num++;
    }
  }
  function createElementFromHTML(htmlString) {
    var div = document.createElement('div');
    div.innerHTML = htmlString;
    return div.firstChild;
  }
  function appendFunc(newNode, existingNode) {
    existingNode.parentNode.insertBefore(newNode, existingNode.nextSibling);
  }
  function toggle(id){
    let iter = 0;
    while(true){
      try{
        document.getElementById('league'+iter).checked = false;
        iter++;
      }catch(e){
        document.getElementById(id).checked = true;
        break;
      }
    }
    currentLeague = document.getElementById("label" + id.slice(-1)).textContent;
    fill();
  }
  async function fill(search = ''){
    const response = await fetch('https://api.poe.watch/get?league='+ currentLeague +'&category=' + selectedCategory);
    const json = await response.json();
    var table = document.getElementById("table");
    var num = 0;
    while (num < json.length){
      const temp = json[num];
      var row = table.insertRow(num+1);
      var cell1 = row.insertCell(0);
      var cell2 = row.insertCell(1);
      var cell3 = row.insertCell(2);
      var cell4 = row.insertCell(3);
      cell1.innerHTML = '<img style = "height: 35px; width:auto;"src="'+temp["icon"]+'"> &nbsp; &nbsp;'+temp["name"];
      cell2.innerHTML = temp["exalted"].toFixed(2);
      cell3.innerHTML = temp["mean"].toFixed(2);
      cell4.innerHTML = temp["change"]+"%";
      row.style = "background-color:rgba(0, 0, 0, 0.5);"
      num++;
    }
  }
  function buttonToggle(id){
    console.log("asdf")
    selectedCategory = id;
    fill();
  }
  fillLeagues();
  </script>
</html>
